<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.test1.mapper.MemberMapper">
	<select id="memberLogin" parameterType="hashmap" resultType="com.example.test1.model.Member">
		SELECT *
		FROM TBL_USER
		WHERE USERID = #{id} 
		<!--AND PASSWORD = #{pwd}-->
	</select>
	
	
	
	<select id="memberCheck" parameterType="hashmap" resultType="com.example.test1.model.Member">
		SELECT *
		FROM TBL_USER
		WHERE USERID = #{id}
	</select>
	
	<select id="memberSearch" parameterType="hashmap" resultType="com.example.test1.model.Member">
		SELECT *
		FROM TBL_USER
		WHERE USERID = #{userId} AND NAME=#{name} AND REPLACE(PHONE,'-','')=REPLACE(#{phone},'-','')
	</select>
	
	
	<insert id="memberAdd" parameterType="hashmap">
		INSERT INTO TBL_USER VALUES (#{id}, #{hashPwd}, #{name},NULL,NULL,NULL, #{addr},#{phone},NULL,#{gender},#{status},SYSDATE,SYSDATE,0)
	</insert>
	
	
	<select id="memberList" parameterType="hashmap" resultType="com.example.test1.model.Member">
		SELECT U.*, DECODE(BIRTH,NULL,'정보없음',SUBSTR(BIRTH,3,2)||'.'||SUBSTR(BIRTH,5,2)||'.'||SUBSTR(BIRTH,7,2)) AS DATE_OF_BIRTH, TO_CHAR(CDATETIME,'YYYY.MM.DD') AS JOINTIME 
		FROM TBL_USER U
		WHERE 1=1
		<if test="option=='all'">
   			AND (
				USERID LIKE '%'||#{keyWord}||'%' OR NICKNAME LIKE '%'||#{keyWord}||'%'
				)
   		</if>
   		<if test="option=='userId'">
   			AND USERID LIKE '%'||#{keyWord}||'%'
   		</if>
   		<if test="option=='nickName'">
   			AND NICKNAME LIKE '%'||#{keyWord}||'%'
   		</if>
		ORDER BY DATE_OF_BIRTH DESC
		OFFSET #{offset} ROWS FETCH NEXT #{fetchRows} ROWS ONLY
	</select>
	
	
	<select id="memberCount" parameterType="hashmap" resultType="int">
		SELECT COUNT(USERID) AS USERNUM
		FROM TBL_USER U
		WHERE 1=1
		<if test="option=='all'">
   			AND (
				USERID LIKE '%'||#{keyWord}||'%' OR NICKNAME LIKE '%'||#{keyWord}||'%'
				)
   		</if>
   		<if test="option=='userId'">
   			AND USERID LIKE '%'||#{keyWord}||'%'
   		</if>
   		<if test="option=='nickName'">
   			AND NICKNAME LIKE '%'||#{keyWord}||'%'
   		</if>
   	</select>
   	
   	<delete id="memberListDelete"  parameterType="hashmap">
		DELETE FROM TBL_USER WHERE USERID IN
		<foreach collection="list" item="item" index="index" open="(" close=")" separator=",">
			#{item}
		</foreach>
	</delete>
	
	<update id="cntIncrease" parameterType="hashmap">
			UPDATE TBL_USER
			SET CNT=CNT+1
			WHERE USERID=#{id}
	</update>
	
	<update id="cntInit" parameterType="hashmap">
			UPDATE TBL_USER
			SET CNT=0
			WHERE USERID=#{id}
	</update>
	
	<update id="pwdUpdate" parameterType="hashmap">
		UPDATE TBL_USER 
		SET PASSWORD=#{hashPwd}
		WHERE USERID=#{userId}
	</update>
	
	<select id="pwdCheck" parameterType="hashmap">
		SELECT COUNT(*)
		FROM TBL_USER
		WHERE USERID = #{userId} AND PASSWORD=#{hashPwd}
	</select>
	
	<select id="memberSelect" parameterType="hashmap" resultType="com.example.test1.model.Member">
		SELECT U.*, DECODE(BIRTH,NULL,'정보없음',SUBSTR(BIRTH,3,2)||'.'||SUBSTR(BIRTH,5,2)||'.'||SUBSTR(BIRTH,7,2)) AS DATE_OF_BIRTH, TO_CHAR(CDATETIME,'YYYY.MM.DD') AS JOINTIME 
		 FROM TBL_USER U
		WHERE U.USERID = #{userId}
	</select>
	
	

	
	
	
</mapper>




